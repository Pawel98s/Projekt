{% extends "navibar.html" %}

{% block title %}{{ name }}{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/product.css') }}">
{% endblock %}


{% block content %}

<div class="container bg-white p-4 rounded shadow-sm">

    <h1 class="mb-3">{{ name }}</h1>

    {% if link %}
        <a href="{{ link }}" target="_blank" class="btn btn-primary mb-4">
            ğŸŒ Strona producenta
        </a>
    {% endif %}

    <h4 class="mb-3">ğŸ“˜ Opis produktu</h4>

    {% set sections = description.split('## ') %}
    {% for sec in sections %}
        {% if sec.strip() %}
            {% set lines = sec.split('\n', 1) %}
            {% set title = lines[0] %}
            {% set content = lines[1] if lines|length > 1 else '' %}

            <div class="mb-4">
                <h5 class="border-bottom pb-1 text-primary">{{ title }}</h5>
                <div class="md mt-2">{{ content }}</div>
            </div>
        {% endif %}
    {% endfor %}


    <div class="review-card">
        <h4>ğŸ’¬ Opinie uÅ¼ytkownikÃ³w</h4>

        {% if reviews %}
            {% for r in reviews %}
                <div class="review-item">
                    <div class="review-text">â€œ{{ r.text }}â€</div>

                    <div>
                        <button onclick="startEditReview(this, {{ r.id }})"
                                class="btn btn-sm btn-outline-warning">âœ</button>
                        <button onclick="deleteReview({{ r.id }})"
                                class="btn btn-sm btn-outline-danger">ğŸ—‘</button>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="text-muted mt-2">Brak opinii dla tego produktu.</div>
        {% endif %}

        <div class="add-review-box">
            <form id="addReviewForm" data-product-id="{{ product_id }}">
                <label class="form-label fw-bold">â• Dodaj opiniÄ™</label>
                <textarea class="form-control mb-2" rows="2" required></textarea>
                <button class="btn btn-success btn-sm">ğŸ’¬ Dodaj</button>
            </form>
        </div>
    </div>

</div>

{% endblock %}


{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/product.js') }}" defer></script>
{% endblock %}