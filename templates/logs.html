{% extends "navibar.html" %}

{% block title %}Logi systemowe{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/logs.css') }}">
{% endblock %}


{% block content %}

<h1>Panel logów systemowych</h1>

<input id="search"
       type="text"
       class="form-control mb-3"
       placeholder="Szukaj w logach..."
       onkeyup="filterLogs()"
       style="max-width: 300px;">

<table id="logTable" data-sort="asc">
    <tr>
        <th onclick="sortTable(0)">ID</th>
        <th onclick="sortTable(1)">Akcja</th>
        <th onclick="sortTable(2)">Szczegóły</th>
        <th onclick="sortTable(3)">Data</th>
    </tr>

    {% for log in logs %}
    <tr>
        <td>{{ log[0] }}</td>
        <td>{{ log[1] }}</td>
        <td>{{ log[2] }}</td>
        <td>{{ log[3] }}</td>
    </tr>
    {% endfor %}
</table>

{% endblock %}


{% block extra_scripts %}
<script>
function sortTable(col) {
    let table = document.getElementById("logTable");
    let rows = Array.from(table.rows).slice(1);
    let asc = table.getAttribute("data-sort") !== "asc";

    rows.sort((a, b) => {
        let A = a.cells[col].innerText.trim();
        let B = b.cells[col].innerText.trim();
        return asc ? A.localeCompare(B) : B.localeCompare(A);
    });

    rows.forEach(r => table.appendChild(r));
    table.setAttribute("data-sort", asc ? "asc" : "desc");
}

function filterLogs() {
    let filter = document.getElementById("search").value.toLowerCase();
    let rows = document.querySelectorAll("#logTable tr");

    rows.forEach((row, idx) => {
        if (idx === 0) return;
        let text = row.innerText.toLowerCase();
        row.style.display = text.includes(filter) ? "" : "none";
    });
}
</script>
{% endblock %}